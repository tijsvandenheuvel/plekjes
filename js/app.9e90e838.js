(function(e){function t(t){for(var o,a,s=t[0],l=t[1],c=t[2],u=0,p=[];u<s.length;u++)a=s[u],Object.prototype.hasOwnProperty.call(r,a)&&r[a]&&p.push(r[a][0]),r[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);d&&d(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],o=!0,a=1;a<n.length;a++){var s=n[a];0!==r[s]&&(o=!1)}o&&(i.splice(t--,1),e=l(l.s=n[0]))}return e}var o={},a={app:0},r={app:0},i=[];function s(e){return l.p+"js/"+({about:"about"}[e]||e)+"."+{about:"16dca34b"}[e]+".js"}function l(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.e=function(e){var t=[],n={about:1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise((function(t,n){for(var o="css/"+({about:"about"}[e]||e)+"."+{about:"8b56df91"}[e]+".css",r=l.p+o,i=document.getElementsByTagName("link"),s=0;s<i.length;s++){var c=i[s],u=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(u===o||u===r))return t()}var p=document.getElementsByTagName("style");for(s=0;s<p.length;s++){c=p[s],u=c.getAttribute("data-href");if(u===o||u===r)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var o=t&&t.target&&t.target.src||r,i=new Error("Loading CSS chunk "+e+" failed.\n("+o+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=o,delete a[e],d.parentNode.removeChild(d),n(i)},d.href=r;var f=document.getElementsByTagName("head")[0];f.appendChild(d)})).then((function(){a[e]=0})));var o=r[e];if(0!==o)if(o)t.push(o[2]);else{var i=new Promise((function(t,n){o=r[e]=[t,n]}));t.push(o[2]=i);var c,u=document.createElement("script");u.charset="utf-8",u.timeout=120,l.nc&&u.setAttribute("nonce",l.nc),u.src=s(e);var p=new Error;c=function(t){u.onerror=u.onload=null,clearTimeout(d);var n=r[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;p.message="Loading chunk "+e+" failed.\n("+o+": "+a+")",p.name="ChunkLoadError",p.type=o,p.request=a,n[1](p)}r[e]=void 0}};var d=setTimeout((function(){c({type:"timeout",target:u})}),12e4);u.onerror=u.onload=c,document.head.appendChild(u)}return Promise.all(t)},l.m=e,l.c=o,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)l.d(n,o,function(t){return e[t]}.bind(null,o));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var p=0;p<c.length;p++)t(c[p]);var d=u;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},2140:function(e,t,n){"use strict";n("b4ac")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("7a23"),a={id:"main"};function r(e,t,n,r,i,s){var l=Object(o["A"])("router-view"),c=Object(o["A"])("Nav");return Object(o["t"])(),Object(o["f"])(o["a"],null,[Object(o["g"])("div",a,[Object(o["j"])(l)]),Object(o["j"])(c,{id:"nav"})],64)}var i={class:"nav"},s=Object(o["i"])("I"),l=Object(o["i"])("O"),c=Object(o["i"])("E");function u(e,t,n,a,r,u){var p=Object(o["A"])("router-link");return Object(o["t"])(),Object(o["f"])("div",i,[Object(o["j"])(p,{to:"/intern"},{default:Object(o["H"])((function(){return[s]})),_:1}),Object(o["j"])(p,{to:"/"},{default:Object(o["H"])((function(){return[l]})),_:1}),Object(o["j"])(p,{to:"/extern"},{default:Object(o["H"])((function(){return[c]})),_:1})])}var p={},d=(n("2140"),n("6b0d")),f=n.n(d);const h=f()(p,[["render",u]]);var m=h,k={name:"App",components:{Nav:m},data:function(){return{}}};n("8c74");const g=f()(k,[["render",r]]);var v=g,y=n("da6f"),b=n("e370");Object(o["c"])(v).use(y["a"]).use(b["a"]).mount("#app")},"58f2":function(e,t,n){},"7c15":function(e,t,n){"use strict";n.r(t),n.d(t,"setUserData",(function(){return i})),n.d(t,"setSelectedPlekje",(function(){return s})),n.d(t,"updateSelectedPlekje",(function(){return l})),n.d(t,"getPlekjesWithoutTags",(function(){return u})),n.d(t,"setSelectedPlekollection",(function(){return d})),n.d(t,"setFeatureCollectionToEdit",(function(){return f})),n.d(t,"addSinglePlekjeToMap",(function(){return h})),n.d(t,"setFeatureCollectionToMap",(function(){return m})),n.d(t,"saveCreatedPlekollection",(function(){return k})),n.d(t,"editPlekollectionFlow",(function(){return g})),n.d(t,"checkUserNameAvailability",(function(){return v}));n("e9c4"),n("4de4"),n("d3b7"),n("accc"),n("0d03"),n("b0c0"),n("ac1f"),n("5319"),n("caad"),n("2532"),n("d81d"),n("4160"),n("159b"),n("99af"),n("a15b"),n("4e82");var o=n("da6f"),a=n("e370"),r=function(e,t,n,o){var a=new XMLHttpRequest;a.open(e,t,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization","Bearer ".concat(localStorage.getItem("access_token"))),a.send(n),a.onreadystatechange=function(){4==a.readyState&&"200"==a.status&&o(a.responseText)}};function i(){var e=JSON.stringify({email:o["a"].state.userEmail});r("POST","https://plekjes-server.herokuapp.com/users/get_one",e,(function(e){var t=JSON.parse(e);t?o["a"].state.userData=t:o["a"].state.userToBeCreated=!0}))}function s(e,t){N(e,(function(e){p(e.tags,(function(e){t(e)}))}))}function l(e,t){var n=o["a"].state.selectedPlekje;switch(t){case"add":n.tags.push(e._id);break;case"remove":n.tags=n.tags.filter((function(t){return t!=e._id}));break}n.updatedAt=(new Date).toISOString(),c(n._id,n,(function(){})),E(e._id,(function(e){switch(t){case"add":e.plekjes.push({_id:n._id,name:n.name});break;case"remove":e.plekjes=e.plekjes.filter((function(e){return e._id!=n._id}));break}e.updatedAt=(new Date).toISOString(),_(e._id,e,(function(){}))}))}var c=function(e,t,n){r("PUT","https://plekjes-server.herokuapp.com/plekjes/update/"+e,JSON.stringify(t),(function(e){n()}))};function u(e,t){var n=JSON.stringify({ids:e});r("POST","https://plekjes-server.herokuapp.com/plekjes/get_no_tag/",n,(function(e){t(JSON.parse(e))}))}var p=function(e,t){var n=JSON.stringify({ids:e});r("POST","https://plekjes-server.herokuapp.com/plekollections/get_multiple/",n,(function(e){var n=JSON.parse(e);t(n||[])}))};function d(e,t){E(e,(function(e){o["a"].state.selectedPlekollection=e,t()}))}function f(){b((function(e){o["a"].state.featureCollectionToEdit=e,a["a"].replace("/")}))}function h(){console.log(o["a"].state.selectedPlekje.name),o["a"].state.featureCollections.map((function(e){return e.props.name})).includes(o["a"].state.selectedPlekje.name)||o["a"].state.featureCollections.push(O([o["a"].state.selectedPlekje],!0)),a["a"].replace("/")}function m(e){o["a"].state.featureCollections.map((function(e){return e.props.name})).includes(o["a"].state.selectedPlekollection.name)?a["a"].replace("/"):b((function(t){o["a"].state.featureCollections.push(t),e()}))}function k(e){if(o["a"].state.creatingPlekollection=!1,1==o["a"].state.featureCollectionToCreate.features.length&&T(o["a"].state.featureCollectionToCreate.features,null,(function(e){S(null,e)})),o["a"].state.featureCollectionToCreate.features.length>1){var t=prompt("Name Plekollection"," ");T(o["a"].state.featureCollectionToCreate.features,t,(function(n){C(n,t),e(!0)}))}else e(!1)}function g(e){o["a"].state.editingPlekollection=!1;var t=[];o["a"].state.featureCollectionToEdit.features.forEach((function(e){e.properties.id||t.push(e)})),t.length>0?T(t,o["a"].state.featureCollectionToEdit.props.name,(function(t){P(t,(function(){e()}))})):P(null,(function(){e()}))}function v(e,t){var n=JSON.stringify({username:e});r("POST","https://plekjes-server.herokuapp.com/users/name_check",n,(function(n){var o="true"===n;o&&y(e),t(o)}))}var y=function(e){var t={email:o["a"].state.userEmail,username:e,my_plekjes:[],my_plekollections:[]};r("POST","https://plekjes-server.herokuapp.com/users/new",JSON.stringify(t),(function(e){o["a"].state.userToBeCreated=!1,i()}))},b=function(e){var t=o["a"].state.selectedPlekollection.plekjes.map((function(e){return e._id}));j(t,(function(t){e(O(t))}))},j=function(e,t){var n=JSON.stringify({ids:e});r("POST","https://plekjes-server.herokuapp.com/plekjes/get_multiple/",n,(function(e){t(JSON.parse(e))}))},O=function(e,t){var n;return n=t?{type:"FeatureCollection",props:{name:o["a"].state.selectedPlekje.name,id:o["a"].state.selectedPlekje._id},features:[]}:{type:"FeatureCollection",props:{name:o["a"].state.selectedPlekollection.name,id:o["a"].state.selectedPlekollection._id},features:[]},e.forEach((function(e){n.features.push({type:"Feature",properties:{name:e.name,id:e._id},geometry:e.geometry})})),n},T=function(e,t,n){for(var a=[],i=0;i<e.length;i++)a.push({name:e[i].properties.name,tags:[],founder:o["a"].state.userData.username,geometry:e[i].geometry});r("POST","https://plekjes-server.herokuapp.com/plekjes/add_multiple",JSON.stringify(a),(function(e){n(JSON.parse(e))}))},C=function(e,t){var n={name:t,collector:o["a"].state.userData.username,plekjes:e};r("POST","https://plekjes-server.herokuapp.com/plekollections/new",JSON.stringify(n),(function(t){S(JSON.parse(t),e)}))},S=function(e,t,n){var a=JSON.stringify({email:o["a"].state.userEmail});r("POST","https://plekjes-server.herokuapp.com/users/get_one",a,(function(o){var a=JSON.parse(o);if(e&&a.my_plekollections.push({name:e.name,_id:e._id}),n){var s=n.map((function(e){return e._id}));a.my_plekjes=a.my_plekjes.filter((function(e){return!s.includes(e._id)}))}t&&(a.my_plekjes=a.my_plekjes.concat(t)),r("PUT","https://plekjes-server.herokuapp.com/users/update/"+a._id,JSON.stringify(a),(function(e){i()}))}))},P=function(e,t){E(o["a"].state.featureCollectionToEdit.props.id,(function(n){if(!n)return t();o["a"].state.selectedPlekollection=n;var a=n.plekjes.map((function(e){return e.name})),r=o["a"].state.featureCollectionToEdit.features.map((function(e){return e.properties.name}));if(a.sort().join(",")===r.sort().join(","))o["a"].state.editingPlekollection=!1;else{var i=o["a"].state.featureCollectionToEdit.features.map((function(e){return e.properties.id})).filter((function(e){return e})),s=[],l=[];n.plekjes.forEach((function(e){i.includes(e._id)?s.push(e):l.push(e)})),n.plekjes=s,w(l.map((function(e){return e._id}))),e&&(n.plekjes=n.plekjes.concat(e)),n.updatedAt=(new Date).toISOString(),_(o["a"].state.featureCollectionToEdit.props.id,n,(function(){S(null,e,l),o["a"].state.editingPlekollection=!1,d(o["a"].state.featureCollectionToEdit.props.id,(function(){m((function(){t()}))}))}))}}))},_=function(e,t,n){r("PUT","https://plekjes-server.herokuapp.com/plekollections/update/"+e,JSON.stringify(t),(function(e){n()}))},w=function(e){r("DELETE","https://plekjes-server.herokuapp.com/plekjes/delete_multiple",JSON.stringify({ids:e}),(function(e){}))},E=function(e,t){r("GET","https://plekjes-server.herokuapp.com/plekollections/get_one/"+e,null,(function(e){e&&t(JSON.parse(e))}))},N=function(e,t){r("GET","https://plekjes-server.herokuapp.com/plekjes/get_one/"+e,null,(function(e){if(e){var n=JSON.parse(e);o["a"].state.selectedPlekje=n,t(n)}}))}},"7ce0":function(e,t,n){"use strict";n("b7d2")},"8c74":function(e,t,n){"use strict";n("58f2")},b4ac:function(e,t,n){},b7d2:function(e,t,n){},da6f:function(e,t,n){"use strict";n("4de4"),n("d3b7"),n("b0c0"),n("e9c4"),n("0d03"),n("ac1f"),n("5319");var o=n("5502"),a=n("b0af"),r=n("e370");t["a"]=Object(o["a"])({state:{auth0:new a["a"].WebAuth({domain:"tijs-app.eu.auth0.com",clientID:"GSTtuqSVd4zA7NvQ8qeVszNDDMhJq0Hi",redirectUri:"https://tijsvandenheuvel.github.io/plekjes/auth0callback",responseType:"token id_token",scope:"openid profile email",audience:"https://plekjes-api.be"}),userIsAuthenticated:!1,userEmail:null,userData:null,userToBeCreated:!1,selectedPlekollection:null,selectedPlekje:null,featureCollections:[],featureCollectionToEdit:null,featureCollectionToCreate:{features:[]},creatingPlekollection:!1,editingPlekollection:!1},mutations:{setUserIsAuthenticated:function(e,t){e.userIsAuthenticated=t},filterFeatureCollections:function(e,t){e.featureCollections=e.featureCollections.filter((function(e){return e.props.name!=t}))}},actions:{auth0Login:function(e){e.state.auth0.authorize()},auth0HandleAuthentication:function(e){e.state.auth0.parseHash((function(t,n){if(n&&n.accessToken&&n.idToken){var o=JSON.stringify((new Date).getTime()+1e3*n.expiresIn);localStorage.setItem("access_token",n.accessToken),localStorage.setItem("id_token",n.idToken),localStorage.setItem("expires_at",o),e.dispatch("auth0getUserEmail"),r["a"].replace("/intern"),t&&(alert("login failed"),r["a"].replace("/"),console.log(t))}}))},auth0getUserEmail:function(e){localStorage.getItem("access_token")&&e.state.auth0.client.userInfo(localStorage.getItem("access_token"),(function(t,n){n&&(e.state.userEmail=n.email)}))},auth0Logout:function(e){localStorage.removeItem("access_token"),localStorage.removeItem("id_token"),localStorage.removeItem("expires_at"),window.location.href="https://tijs-app.eu.auth0.com/v2/logout?returnTo=https://tijsvandenheuvel.github.io/plekjes&client_id=GSTtuqSVd4zA7NvQ8qeVszNDDMhJq0Hi"}}})},e370:function(e,t,n){"use strict";n("d3b7"),n("3ca3"),n("ddb0"),n("45fc"),n("0d03"),n("ac1f"),n("5319");var o=n("6c02"),a=n("7a23");function r(e,t,n,o,r,i){var s=Object(a["A"])("Map");return Object(a["t"])(),Object(a["d"])(s)}var i={id:"mapContainer"},s={key:0,class:"leaflet-bottom"},l={class:"map-buttons"};function c(e,t,n,o,r,c){return Object(a["t"])(),Object(a["f"])("div",i,[this.$store.state.userIsAuthenticated?(Object(a["t"])(),Object(a["f"])("div",s,[Object(a["g"])("div",l,[this.$store.state.creatingPlekollection||this.$store.state.editingPlekollection?(Object(a["t"])(),Object(a["f"])("button",{key:0,class:"btn",onClick:t[0]||(t[0]=function(e){return c.save()})}," save ")):1==this.$store.state.featureCollections.length&&this.$store.state.featureCollections.features&&this.$store.state.featureCollections.features.length>1?(Object(a["t"])(),Object(a["f"])("button",{key:1,class:"btn",onClick:t[1]||(t[1]=function(e){return c.edit()})}," edit ")):(Object(a["t"])(),Object(a["f"])("button",{key:2,class:"btn",onClick:t[2]||(t[2]=function(e){return c.create()})},"+"))])])):Object(a["e"])("",!0)])}n("d81d"),n("b0c0"),n("4160"),n("159b");var u,p=n("e11e"),d=n.n(p),f=(n("6cc5"),n("20d6"),n("5fbf"),n("7c15"));delete d.a.Icon.Default.prototype._getIconUrl,d.a.Icon.Default.mergeOptions({iconRetinaUrl:n("584d"),iconUrl:n("6397"),shadowUrl:n("e2b9")});var h={data:function(){return{osm_layer:d.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),layercontrol:d.a.control.layers(),polygonMarkerOptions:{radius:2,fillColor:"green",color:"green",weight:2,opacity:.5,fillOpacity:.2},pointMarkerOptions:{radius:3,fillColor:"red",color:"red",weight:3,opacity:1,fillOpacity:.2},drawControl:null}},methods:{setupMap:function(){u=d.a.map("mapContainer",{center:[51.11,4.46],crs:d.a.CRS.EPSG3857,zoom:11,zoomControl:!0,preferCanvas:!1}),this.osm_layer.addTo(u),d.a.control.scale().addTo(u),this.layercontrol.addTo(u),this.layercontrol.addBaseLayer(this.osm_layer,"OSM layer")},addToolTip:function(e,t){e.properties&&e.properties.name&&t.bindTooltip(e.properties.name)},displayFeatures:function(e){var t,n=this;t=this.$store.state.editingPlekollection?this.drawnItems:d.a.featureGroup().addTo(u),e.features.forEach((function(e){switch(e.geometry.type){case"Point":n.$store.state.editingPlekollection?d.a.geoJSON(e,{onEachFeature:n.addToolTip}).addTo(t):d.a.geoJSON(e,{pointToLayer:function(e,t){return d.a.circleMarker(t,n.pointMarkerOptions)},onEachFeature:n.addToolTip}).addTo(t);break;case"Polygon":case"MultiPolygon":d.a.geoJSON(e,{style:n.polygonMarkerOptions,onEachFeature:n.addToolTip}).addTo(t);break;default:d.a.geoJSON(e,{onEachFeature:n.addToolTip}).addTo(t)}})),this.$store.state.editingPlekollection||this.layercontrol.addOverlay(t,e.props.name)},clearMapLayers:function(){var e=this;u.eachLayer((function(t){t._url||(u.removeLayer(t),e.layercontrol.removeLayer(t))}))},displayFeatureCollections:function(){var e=this;this.clearMapLayers(),this.$store.state.featureCollections.forEach((function(t){e.displayFeatures(t)}))},addDrawControl:function(e){var t=this;this.drawControl||(this.drawnItems=(new d.a.FeatureGroup).addTo(u),this.layercontrol.addOverlay(this.drawnItems,e),this.drawControl=new d.a.Control.Draw({edit:{featureGroup:this.drawnItems,edit:!1},draw:{marker:!0,polygon:!0,polyline:!0,circle:!1,rectangle:!1,circlemarker:!1}}),this.drawControl.addTo(u),d.a.Draw.Polyline.prototype._onTouch=d.a.Util.falseFn,u.on("draw:created",(function(e){var n=e.layer;n.properties={};var o=n.feature=n.feature||{};o.type="Feature",o.properties=o.properties||{};var a=prompt("Name Plekje"," ");null!=a&&" "!=a&&(o.properties["name"]=a,n.bindTooltip(o.properties["name"]),t.drawnItems.addLayer(n),t.$store.state.creatingPlekollection?t.$store.state.featureCollectionToCreate.features.push(n.toGeoJSON()):t.$store.state.editingPlekollection&&t.$store.state.featureCollectionToEdit.features.push(n.toGeoJSON()))})))},create:function(){this.$store.state.creatingPlekollection||(this.$store.state.creatingPlekollection=!0,this.addDrawControl("new plekollection"))},save:function(){var e=this;this.$store.state.editingPlekollection?f.editPlekollectionFlow((function(){e.displayFeatureCollections()})):f.saveCreatedPlekollection((function(t){t&&u.eachLayer((function(t){t._url||(u.removeLayer(t),e.layercontrol.removeLayer(t))}))})),this.drawnItems=null,this.drawControl=null,this.layercontrol=d.a.control.layers(),u.remove(),this.setupMap(),this.displayFeatureCollections()},edit:function(){this.$store.state.editingPlekollection=!0,this.$store.state.featureCollectionToEdit=this.$store.state.featureCollections[0],this.$store.state.featureCollections=[],this.displayFeatureCollections(),this.addDrawControl(this.$store.state.featureCollectionToEdit.props.name),this.displayFeatures(this.$store.state.featureCollectionToEdit)}},mounted:function(){this.setupMap(),this.$store.state.creatingPlekollection?this.addDrawControl("new plekollection"):this.$store.state.editingPlekollection?(this.addDrawControl(this.$store.state.featureCollectionToEdit.props.name),this.displayFeatures(this.$store.state.featureCollectionToEdit)):this.displayFeatureCollections()},beforeUnmount:function(){u&&u.remove()}},m=(n("7ce0"),n("6b0d")),k=n.n(m);const g=k()(h,[["render",c]]);var v=g,y={components:{Map:v}};const b=k()(y,[["render",r]]);var j=b,O=n("da6f"),T=[{path:"/",name:"Home",component:j},{path:"/auth0callback",component:j},{path:"/intern",name:"Intern",component:function(){return n.e("about").then(n.bind(null,"2623"))}},{path:"/extern",name:"Extern",component:function(){return n.e("about").then(n.bind(null,"5a21"))}}],C=Object(o["a"])({history:Object(o["b"])("/"),routes:T});C.beforeEach((function(e,t,n){e.matched.some((function(e){return"/auth0callback"==e.path}))&&O["a"].dispatch("auth0HandleAuthentication");var o=!1;if(localStorage.getItem("access_token")&&localStorage.getItem("id_token")&&localStorage.getItem("expires_at")){var a=JSON.parse(localStorage.getItem("expires_at"));o=(new Date).getTime()<a}O["a"].commit("setUserIsAuthenticated",o),e.matched.some((function(e){return e.meta.requiresAuth}))?o?(O["a"].commit("setUserIsAuthenticated",!0),n()):C.replace("/"):n()}));t["a"]=C}});
//# sourceMappingURL=app.9e90e838.js.map