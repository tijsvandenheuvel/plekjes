(function(e){function t(t){for(var n,r,s=t[0],l=t[1],c=t[2],u=0,p=[];u<s.length;u++)r=s[u],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&p.push(a[r][0]),a[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);d&&d(t);while(p.length)p.shift()();return i.push.apply(i,c||[]),o()}function o(){for(var e,t=0;t<i.length;t++){for(var o=i[t],n=!0,r=1;r<o.length;r++){var s=o[r];0!==a[s]&&(n=!1)}n&&(i.splice(t--,1),e=l(l.s=o[0]))}return e}var n={},r={app:0},a={app:0},i=[];function s(e){return l.p+"js/"+({about:"about"}[e]||e)+"."+{about:"b9736aa1"}[e]+".js"}function l(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,l),o.l=!0,o.exports}l.e=function(e){var t=[],o={about:1};r[e]?t.push(r[e]):0!==r[e]&&o[e]&&t.push(r[e]=new Promise((function(t,o){for(var n="css/"+({about:"about"}[e]||e)+"."+{about:"3b6cf430"}[e]+".css",a=l.p+n,i=document.getElementsByTagName("link"),s=0;s<i.length;s++){var c=i[s],u=c.getAttribute("data-href")||c.getAttribute("href");if("stylesheet"===c.rel&&(u===n||u===a))return t()}var p=document.getElementsByTagName("style");for(s=0;s<p.length;s++){c=p[s],u=c.getAttribute("data-href");if(u===n||u===a)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var n=t&&t.target&&t.target.src||a,i=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=n,delete r[e],d.parentNode.removeChild(d),o(i)},d.href=a;var f=document.getElementsByTagName("head")[0];f.appendChild(d)})).then((function(){r[e]=0})));var n=a[e];if(0!==n)if(n)t.push(n[2]);else{var i=new Promise((function(t,o){n=a[e]=[t,o]}));t.push(n[2]=i);var c,u=document.createElement("script");u.charset="utf-8",u.timeout=120,l.nc&&u.setAttribute("nonce",l.nc),u.src=s(e);var p=new Error;c=function(t){u.onerror=u.onload=null,clearTimeout(d);var o=a[e];if(0!==o){if(o){var n=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src;p.message="Loading chunk "+e+" failed.\n("+n+": "+r+")",p.name="ChunkLoadError",p.type=n,p.request=r,o[1](p)}a[e]=void 0}};var d=setTimeout((function(){c({type:"timeout",target:u})}),12e4);u.onerror=u.onload=c,document.head.appendChild(u)}return Promise.all(t)},l.m=e,l.c=n,l.d=function(e,t,o){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(l.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(o,n,function(t){return e[t]}.bind(null,n));return o},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="/",l.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var p=0;p<c.length;p++)t(c[p]);var d=u;i.push([0,"chunk-vendors"]),o()})({0:function(e,t,o){e.exports=o("56d7")},"33e5":function(e,t,o){"use strict";o("f738")},"56d7":function(e,t,o){"use strict";o.r(t);o("e260"),o("e6cf"),o("cca6"),o("a79d");var n=o("7a23");function r(e,t,o,r,a,i){var s=Object(n["z"])("router-view"),l=Object(n["z"])("Nav");return Object(n["s"])(),Object(n["f"])(n["a"],null,[Object(n["j"])(s),Object(n["j"])(l)],64)}var a={class:"nav"},i=Object(n["i"])("I"),s=Object(n["i"])("O"),l=Object(n["i"])("E");function c(e,t,o,r,c,u){var p=Object(n["z"])("router-link");return Object(n["s"])(),Object(n["f"])("div",a,[Object(n["j"])(p,{to:"/intern"},{default:Object(n["F"])((function(){return[i]})),_:1}),Object(n["j"])(p,{to:"/"},{default:Object(n["F"])((function(){return[s]})),_:1}),Object(n["j"])(p,{to:"/extern"},{default:Object(n["F"])((function(){return[l]})),_:1})])}var u={},p=(o("95af"),o("6b0d")),d=o.n(p);const f=d()(u,[["render",c]]);var h=f,m={name:"App",components:{Nav:h},data:function(){return{}}};o("7f61");const g=d()(m,[["render",r]]);var k=g,v=o("da6f"),y=o("e370");Object(n["c"])(k).use(v["a"]).use(y["a"]).mount("#app")},"7c15":function(e,t,o){"use strict";o.r(t),o.d(t,"setUserData",(function(){return i})),o.d(t,"setSelectedPlekollection",(function(){return s})),o.d(t,"setFeatureCollectionToEdit",(function(){return l})),o.d(t,"setFeatureCollectionToMap",(function(){return c})),o.d(t,"createPlekollectionFlow",(function(){return u})),o.d(t,"editPlekollectionFlow",(function(){return p})),o.d(t,"checkUserNameAvailability",(function(){return d}));o("e9c4"),o("caad"),o("2532"),o("d81d"),o("b0c0"),o("ac1f"),o("5319"),o("4160"),o("d3b7"),o("159b"),o("4de4"),o("99af"),o("a15b"),o("4e82"),o("accc"),o("0d03");var n=o("da6f"),r=o("e370"),a=function(e,t,o,n){var r=new XMLHttpRequest;r.open(e,t,!0),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("Authorization","Bearer ".concat(localStorage.getItem("access_token"))),r.send(o),r.onreadystatechange=function(){4==r.readyState&&"200"==r.status&&n(r.responseText)}};function i(){var e=JSON.stringify({email:n["a"].state.userEmail});a("POST","https://plekjes-server.herokuapp.com/users/get_one",e,(function(e){var t=JSON.parse(e);t?n["a"].state.userData=t:n["a"].state.userToBeCreated=!0}))}function s(e,t){T(e,(function(e){n["a"].state.selectedPlekollection=e,t()}))}function l(){h((function(e){n["a"].state.featureCollectionToEdit=e}))}function c(e){n["a"].state.featureCollections.map((function(e){return e.props.name})).includes(n["a"].state.selectedPlekollection.name)?r["a"].replace("/"):h((function(t){n["a"].state.featureCollections.push(t),e()}))}function u(e,t){k(e.features,t,(function(e){v(e,t)}))}function p(e){var t=[];n["a"].state.featureCollectionToEdit.features.forEach((function(e){e.properties.id||t.push(e)})),t.length>0?k(t,n["a"].state.featureCollectionToEdit.props.name,(function(t){b(t,(function(){e()}))})):b(null,(function(){e()}))}function d(e,t){var o=JSON.stringify({username:e});a("POST","https://plekjes-server.herokuapp.com/users/name_check",o,(function(o){var n="true"===o;n&&f(e),t(n)}))}var f=function(e){var t={email:n["a"].state.userEmail,username:e,my_plekjes:[],my_plekollections:[]};a("POST","https://plekjes-server.herokuapp.com/users/new",JSON.stringify(t),(function(e){n["a"].state.userToBeCreated=!1,i()}))},h=function(e){var t=n["a"].state.selectedPlekollection.plekjes.map((function(e){return e._id}));m(t,(function(t){e(g(t))}))},m=function(e,t){var o=JSON.stringify({ids:e});a("POST","https://plekjes-server.herokuapp.com/plekjes/get_multiple/",o,(function(e){t(JSON.parse(e))}))},g=function(e){var t={type:"FeatureCollection",props:{name:n["a"].state.selectedPlekollection.name,id:n["a"].state.selectedPlekollection._id},features:[]};return e.forEach((function(e){t.features.push({type:"Feature",properties:{name:e.name,id:e._id},geometry:e.geometry})})),t},k=function(e,t,o){for(var r=[],i=0;i<e.length;i++)r.push({name:e[i].properties.name,tags:[t],founder:n["a"].state.userData.username,geometry:e[i].geometry});a("POST","https://plekjes-server.herokuapp.com/plekjes/add_multiple",JSON.stringify(r),(function(e){o(JSON.parse(e))}))},v=function(e,t){var o={name:t,collector:n["a"].state.userData.username,plekjes:e};a("POST","https://plekjes-server.herokuapp.com/plekollections/new",JSON.stringify(o),(function(t){y(JSON.parse(t),e)}))},y=function(e,t,o){var r=JSON.stringify({email:n["a"].state.userEmail});a("POST","https://plekjes-server.herokuapp.com/users/get_one",r,(function(n){var r=JSON.parse(n);if(e&&r.my_plekollections.push({name:e.name,_id:e._id}),o){var s=o.map((function(e){return e._id}));r.my_plekjes=r.my_plekjes.filter((function(e){return!s.includes(e._id)}))}t&&(r.my_plekjes=r.my_plekjes.concat(t)),a("PUT","https://plekjes-server.herokuapp.com/users/update/"+r._id,JSON.stringify(r),(function(e){i()}))}))},b=function(e,t){T(n["a"].state.featureCollectionToEdit.props.id,(function(o){var r=o.plekjes.map((function(e){return e.name})),a=n["a"].state.featureCollectionToEdit.features.map((function(e){return e.properties.name}));if(r.sort().join(",")===a.sort().join(","))n["a"].state.editingPlekollection=!1;else{var i=n["a"].state.featureCollectionToEdit.features.map((function(e){return e.properties.id})).filter((function(e){return e})),l=[],u=[];o.plekjes.forEach((function(e){i.includes(e._id)?l.push(e):u.push(e)})),o.plekjes=l,j(u.map((function(e){return e._id}))),e&&(o.plekjes=o.plekjes.concat(e)),o.updatedAt=(new Date).toISOString(),O(n["a"].state.featureCollectionToEdit.props.id,o,(function(){y(null,e,u),n["a"].state.editingPlekollection=!1,s(n["a"].state.featureCollectionToEdit.props.id,(function(){c((function(){t()}))}))}))}}))},O=function(e,t,o){a("PUT","https://plekjes-server.herokuapp.com/plekollections/update/"+e,JSON.stringify(t),(function(e){o()}))},j=function(e){a("DELETE","https://plekjes-server.herokuapp.com/plekjes/delete_multiple",JSON.stringify({ids:e}),(function(e){}))},T=function(e,t){a("GET","https://plekjes-server.herokuapp.com/plekollections/get_one/"+e,null,(function(e){e&&(t(JSON.parse(e)),n["a"].state.selectedPlekollection=JSON.parse(e))}))}},"7f61":function(e,t,o){"use strict";o("e01a")},"95af":function(e,t,o){"use strict";o("b5bb")},b5bb:function(e,t,o){},da6f:function(e,t,o){"use strict";o("4de4"),o("d3b7"),o("b0c0"),o("e9c4"),o("0d03"),o("ac1f"),o("5319");var n=o("5502"),r=o("b0af"),a=o("e370");t["a"]=Object(n["a"])({state:{auth0:new r["a"].WebAuth({domain:"tijs-app.eu.auth0.com",clientID:"GSTtuqSVd4zA7NvQ8qeVszNDDMhJq0Hi",redirectUri:"https://tijsvandenheuvel.github.io/plekjes/auth0callback",responseType:"token id_token",scope:"openid profile email",audience:"https://plekjes-api.be"}),userIsAuthenticated:!1,userEmail:null,userData:null,userToBeCreated:!1,selectedPlekollection:null,featureCollections:[],featureCollectionToEdit:null,featureCollectionToCreate:{features:[]},creatingPlekollection:!1,editingPlekollection:!1},mutations:{setUserIsAuthenticated:function(e,t){e.userIsAuthenticated=t},filterFeatureCollections:function(e,t){e.featureCollections=e.featureCollections.filter((function(e){return e.props.name!=t}))}},actions:{auth0Login:function(e){e.state.auth0.authorize()},auth0HandleAuthentication:function(e){e.state.auth0.parseHash((function(t,o){if(o&&o.accessToken&&o.idToken){var n=JSON.stringify((new Date).getTime()+1e3*o.expiresIn);localStorage.setItem("access_token",o.accessToken),localStorage.setItem("id_token",o.idToken),localStorage.setItem("expires_at",n),e.dispatch("auth0getUserEmail"),a["a"].replace("/intern"),t&&(alert("login failed"),a["a"].replace("/"),console.log(t))}}))},auth0getUserEmail:function(e){localStorage.getItem("access_token")&&e.state.auth0.client.userInfo(localStorage.getItem("access_token"),(function(t,o){o&&(e.state.userEmail=o.email)}))},auth0Logout:function(e){localStorage.removeItem("access_token"),localStorage.removeItem("id_token"),localStorage.removeItem("expires_at"),window.location.href="https://tijs-app.eu.auth0.com/v2/logout?returnTo=https://tijsvandenheuvel.github.io/plekjes&client_id=GSTtuqSVd4zA7NvQ8qeVszNDDMhJq0Hi"}}})},e01a:function(e,t,o){},e370:function(e,t,o){"use strict";o("d3b7"),o("3ca3"),o("ddb0"),o("45fc"),o("0d03"),o("ac1f"),o("5319");var n=o("6c02"),r=o("7a23");function a(e,t,o,n,a,i){var s=Object(r["z"])("Map");return Object(r["s"])(),Object(r["d"])(s)}var i={id:"mapContainer"},s={key:0,class:"leaflet-bottom"};function l(e,t,o,n,a,l){return Object(r["s"])(),Object(r["f"])("div",i,[this.$store.state.userIsAuthenticated?(Object(r["s"])(),Object(r["f"])("div",s,[this.$store.state.creatingPlekollection||this.$store.state.editingPlekollection?(Object(r["s"])(),Object(r["f"])("button",{key:0,class:"btn",onClick:t[0]||(t[0]=function(e){return l.save()})}," save")):1==this.$store.state.featureCollections.length?(Object(r["s"])(),Object(r["f"])("button",{key:1,class:"btn",onClick:t[1]||(t[1]=function(e){return l.edit()})}," edit")):(Object(r["s"])(),Object(r["f"])("button",{key:2,class:"btn",onClick:t[2]||(t[2]=function(e){return l.create()})},"+"))])):Object(r["e"])("",!0)])}o("d81d"),o("b0c0"),o("4160"),o("159b");var c,u=o("e11e"),p=o.n(u),d=(o("6cc5"),o("20d6"),o("5fbf"),o("7c15"));delete p.a.Icon.Default.prototype._getIconUrl,p.a.Icon.Default.mergeOptions({iconRetinaUrl:o("584d"),iconUrl:o("6397"),shadowUrl:o("e2b9")});var f={data:function(){return{osm_layer:p.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),layercontrol:p.a.control.layers(),polygonMarkerOptions:{radius:2,fillColor:"green",color:"green",weight:2,opacity:.5,fillOpacity:.2},pointMarkerOptions:{radius:3,fillColor:"red",color:"red",weight:3,opacity:1,fillOpacity:.2},drawControl:null}},methods:{setupMap:function(){c=p.a.map("mapContainer",{center:[51.11,4.46],crs:p.a.CRS.EPSG3857,zoom:11,zoomControl:!0,preferCanvas:!1}),this.osm_layer.addTo(c),p.a.control.scale().addTo(c),this.layercontrol.addTo(c),this.layercontrol.addBaseLayer(this.osm_layer,"OSM layer")},addToolTip:function(e,t){e.properties&&e.properties.name&&t.bindTooltip(e.properties.name)},displayFeatures:function(e){var t,o=this;t=this.$store.state.editingPlekollection?this.drawnItems:p.a.featureGroup().addTo(c),e.features.forEach((function(e){switch(e.geometry.type){case"Point":o.$store.state.editingPlekollection?p.a.geoJSON(e,{onEachFeature:o.addToolTip}).addTo(t):p.a.geoJSON(e,{pointToLayer:function(e,t){return p.a.circleMarker(t,o.pointMarkerOptions)},onEachFeature:o.addToolTip}).addTo(t);break;case"Polygon":case"MultiPolygon":p.a.geoJSON(e,{style:o.polygonMarkerOptions,onEachFeature:o.addToolTip}).addTo(t);break;default:p.a.geoJSON(e,{onEachFeature:o.addToolTip}).addTo(t)}})),this.$store.state.editingPlekollection||this.layercontrol.addOverlay(t,e.props.name)},clearMapLayers:function(){var e=this;c.eachLayer((function(t){t._url||(c.removeLayer(t),e.layercontrol.removeLayer(t))}))},displayFeatureCollections:function(){var e=this;this.clearMapLayers(),this.$store.state.featureCollections.forEach((function(t){e.displayFeatures(t)}))},addDrawControl:function(e){var t=this;this.drawControl||(this.drawnItems=(new p.a.FeatureGroup).addTo(c),this.layercontrol.addOverlay(this.drawnItems,e),this.drawControl=new p.a.Control.Draw({edit:{featureGroup:this.drawnItems,edit:!1},draw:{marker:!0,polygon:!0,polyline:!0,circle:!1,rectangle:!1,circlemarker:!1}}),this.drawControl.addTo(c),c.on("draw:created",(function(e){var o=e.layer;o.properties={};var n=o.feature=o.feature||{};n.type="Feature",n.properties=n.properties||{};var r=prompt("Name Plekje"," ");null!=r&&" "!=r&&(n.properties["name"]=r,o.bindTooltip(n.properties["name"]),t.drawnItems.addLayer(o),t.$store.state.creatingPlekollection?t.$store.state.featureCollectionToCreate.features.push(o.toGeoJSON()):t.$store.state.editingPlekollection&&t.$store.state.featureCollectionToEdit.features.push(o.toGeoJSON()))})))},create:function(){this.$store.state.creatingPlekollection||(this.$store.state.creatingPlekollection=!0,this.addDrawControl("new plekollection"))},save:function(){var e=this;if(this.$store.state.editingPlekollection)d.editPlekollectionFlow((function(){e.displayFeatureCollections()})),this.$store.state.editingPlekollection=!1;else{this.$store.state.creatingPlekollection=!1;var t=this.drawnItems.toGeoJSON();if(t.features.length>0){var o=prompt("Name Plekollection"," ");d.createPlekollectionFlow(t,o),c.eachLayer((function(t){t._url||(c.removeLayer(t),e.layercontrol.removeLayer(t))}))}}this.drawnItems=null,this.drawControl=null,this.layercontrol=p.a.control.layers(),c.remove(),this.setupMap(),this.displayFeatureCollections()},edit:function(){this.$store.state.editingPlekollection=!0,this.$store.state.featureCollectionToEdit=this.$store.state.featureCollections[0],this.$store.state.featureCollections=[],this.displayFeatureCollections(),this.addDrawControl(this.$store.state.featureCollectionToEdit.props.name),this.displayFeatures(this.$store.state.featureCollectionToEdit)}},mounted:function(){this.setupMap(),this.$store.state.creatingPlekollection?this.addDrawControl("new plekollection"):this.$store.state.editingPlekollection?(this.addDrawControl(this.$store.state.featureCollectionToEdit.props.name),this.displayFeatures(this.$store.state.featureCollectionToEdit)):this.displayFeatureCollections()},beforeUnmount:function(){c&&c.remove()}},h=(o("33e5"),o("6b0d")),m=o.n(h);const g=m()(f,[["render",l]]);var k=g,v={components:{Map:k}};const y=m()(v,[["render",a]]);var b=y,O=o("da6f"),j=[{path:"/",name:"Home",component:b},{path:"/auth0callback",component:b},{path:"/intern",name:"Intern",component:function(){return o.e("about").then(o.bind(null,"2623"))}},{path:"/extern",name:"Extern",component:function(){return o.e("about").then(o.bind(null,"5a21"))}}],T=Object(n["a"])({history:Object(n["b"])("/"),routes:j});T.beforeEach((function(e,t,o){e.matched.some((function(e){return"/auth0callback"==e.path}))&&O["a"].dispatch("auth0HandleAuthentication");var n=!1;if(localStorage.getItem("access_token")&&localStorage.getItem("id_token")&&localStorage.getItem("expires_at")){var r=JSON.parse(localStorage.getItem("expires_at"));n=(new Date).getTime()<r}O["a"].commit("setUserIsAuthenticated",n),e.matched.some((function(e){return e.meta.requiresAuth}))?n?(O["a"].commit("setUserIsAuthenticated",!0),o()):T.replace("/"):o()}));t["a"]=T},f738:function(e,t,o){}});
//# sourceMappingURL=app.86cd15c4.js.map